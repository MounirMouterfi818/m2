# Use the latest 2.1 version of CircleCI pipeline process engine.
version: 2.1

# Import the Codecov orb
orbs:
  codecov: codecov/codecov@4.0.1

# Define jobs
jobs:
  say-hello:
    docker:
      - image: cimg/base:current
    steps:
      - checkout
      - run:
          name: "Say hello"
          command: "echo Hello, World!"
  
  # Add a job to run tests and upload coverage report
  test:
    docker:
      - image: circleci/openjdk:11-jdk  # Or use the image suitable for your project
    steps:
      - checkout
      - run:
          name: "Run tests with coverage"
          command: mvn -B -DskipTests clean package  # This runs your Maven tests, adjust if necessary
      - run:
          name: Test and Generate Coverage
          command: mvn test jacoco:report 

      - codecov/upload:  # Upload coverage report to Codecov
          file: target/site/jacoco/jacoco.xml 
# Define workflows
workflows:
  say-hello-workflow:
    jobs:
      - say-hello
      - test  # This will run the test job that uploads the coverage report
